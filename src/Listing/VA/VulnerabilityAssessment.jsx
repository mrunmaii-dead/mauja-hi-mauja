import React, { useState, useEffect } from "react";
import styles from './VulnerabilityAssessment.module.css';
import Sidebar from './Sidebar';
import MainContent from './MainContent';
import { useParams } from 'react-router-dom';
import axios from 'axios';

function VulnerabilityAssessmentP() {
  const { ip } = useParams();  // Get the IP from the URL
  const [clientDetails, setClientDetails] = useState(null);  // State to store client details

  // Fetch client details from the server (e.g., user_name, device_id, etc.)
  useEffect(() => {
    const fetchClientDetails = async () => {
      try {
        const response = await axios.get(`http://localhost:5000/client/${ip}`);  // Send IP to Flask to get client details
        setClientDetails(response.data);  // Store client details in state
      } catch (error) {
        console.error('Error fetching client details:', error);
      }
    };

    fetchClientDetails();  // Call the function when component mounts
  }, [ip]);

  return (
    <main className={styles.homepage}>
      <div className={styles.mainContainer}>
        <img 
          src="https://cdn.builder.io/api/v1/image/assets/TEMP/b8935b75327cad0c706c17a676d42793ba2dd0b097d93e7a69ed5d903793b020?placeholderIfAbsent=true&apiKey=6780ef7663fb420989788dbe5af024d1" 
          alt="" 
          className={styles.backgroundImage} 
        />
        <header className={styles.header}>
          {/* Display the username in the title */}
          <h1 className={styles.logo}>Raksha 1 Client Details for User: {clientDetails ? clientDetails.user_name : "Loading..."}</h1>
          <div className={styles.brandName}>AETHERIS</div>
        </header>
        <div className={styles.contentWrapper}>
          <div className={styles.contentContainer}>
            <div className={styles.sidebarColumn}>
              <Sidebar />
            </div>
            <div className={styles.mainColumn}>
              {/* Pass clientDetails and IP as props to MainContent */}
              <MainContent clientDetails={clientDetails} ip={ip} />
            </div>
          </div>
        </div>
      </div>
    </main>
  );
}

export default VulnerabilityAssessmentP;
